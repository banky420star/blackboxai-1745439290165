<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDQN Trading Bot Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .metric:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .metric-label {
            font-weight: 500;
            color: #666;
        }

        .metric-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .profit {
            color: #28a745;
        }

        .loss {
            color: #dc3545;
        }

        .neutral {
            color: #6c757d;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active {
            background-color: #28a745;
            animation: pulse 2s infinite;
        }

        .status-inactive {
            background-color: #dc3545;
        }

        .trades-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .trades-table th,
        .trades-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .trades-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #667eea;
        }

        .action-buy {
            color: #28a745;
            font-weight: bold;
        }

        .action-sell {
            color: #dc3545;
            font-weight: bold;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: transform 0.2s ease;
            margin-bottom: 20px;
        }

        .refresh-btn:hover {
            transform: scale(1.05);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ DDQN Trading Bot</h1>
            <p>Real-time monitoring and performance tracking</p>
        </div>

        <button class="refresh-btn" onclick="refreshData()">
            üîÑ Refresh Data
        </button>

        <div id="error-container"></div>

        <div class="dashboard">
            <!-- Wallet Balance -->
            <div class="card">
                <h3>üí∞ Wallet Balance</h3>
                <div id="wallet-balance">
                    <div class="loading">Loading...</div>
                </div>
            </div>

            <!-- Profit/Loss -->
            <div class="card">
                <h3>üìä Profit/Loss</h3>
                <div id="profit-loss">
                    <div class="loading">Loading...</div>
                </div>
            </div>

            <!-- Training Status -->
            <div class="card">
                <h3>üîÑ Training Status</h3>
                <div id="training-status">
                    <div class="loading">Loading...</div>
                </div>
            </div>

            <!-- Model Indicators -->
            <div class="card">
                <h3>üìà Model Indicators</h3>
                <div id="model-indicators">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Trade History -->
        <div class="card">
            <h3>üìã Recent Trades</h3>
            <div id="trade-history">
                <div class="loading">Loading...</div>
            </div>
        </div>
    </div>

    <script>
        // API endpoints
        const API_BASE = '/api';
        
        // Update intervals (in milliseconds)
        const UPDATE_INTERVALS = {
            wallet: 30000,    // 30 seconds
            profit: 10000,    // 10 seconds
            status: 5000,     // 5 seconds
            indicators: 15000, // 15 seconds
            trades: 20000     // 20 seconds
        };

        // Error handling
        function showError(message) {
            const errorContainer = document.getElementById('error-container');
            errorContainer.innerHTML = `<div class="error">‚ùå ${message}</div>`;
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000);
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        // Format date
        function formatDate(dateString) {
            return new Date(dateString).toLocaleString();
        }

        // API calls
        async function fetchAPI(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error(`Error fetching ${endpoint}:`, error);
                throw error;
            }
        }

        // Update wallet balance
        async function updateWalletBalance() {
            try {
                const data = await fetchAPI('/account/wallet-balance');
                const container = document.getElementById('wallet-balance');
                
                if (data.coins && data.coins.length > 0) {
                    let html = '';
                    data.coins.forEach(coin => {
                        html += `
                            <div class="metric">
                                <span class="metric-label">${coin.coin}</span>
                                <span class="metric-value">${formatCurrency(coin.walletBalance)}</span>
                            </div>
                        `;
                    });
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div class="loading">No wallet data available</div>';
                }
            } catch (error) {
                showError('Failed to load wallet balance');
            }
        }

        // Update profit/loss
        async function updateProfitLoss() {
            try {
                const data = await fetchAPI('/profit_loss');
                const container = document.getElementById('profit-loss');
                
                if (data.profit !== undefined) {
                    const profitClass = data.profit >= 0 ? 'profit' : 'loss';
                    container.innerHTML = `
                        <div class="metric">
                            <span class="metric-label">Current Profit/Loss</span>
                            <span class="metric-value ${profitClass}">${formatCurrency(data.profit)}</span>
                        </div>
                    `;
                } else {
                    container.innerHTML = '<div class="loading">No profit data available</div>';
                }
            } catch (error) {
                showError('Failed to load profit/loss data');
            }
        }

        // Update training status
        async function updateTrainingStatus() {
            try {
                const data = await fetchAPI('/training_status');
                const container = document.getElementById('training-status');
                
                if (data.logs && data.logs.length > 0) {
                    const log = data.logs[0];
                    container.innerHTML = `
                        <div class="metric">
                            <span class="metric-label">Status</span>
                            <span class="metric-value">
                                <span class="status-indicator status-active"></span>
                                Active
                            </span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Current Log</span>
                            <span class="metric-value neutral">${log}</span>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="metric">
                            <span class="metric-label">Status</span>
                            <span class="metric-value">
                                <span class="status-indicator status-inactive"></span>
                                Inactive
                            </span>
                        </div>
                    `;
                }
            } catch (error) {
                showError('Failed to load training status');
            }
        }

        // Update model indicators
        async function updateModelIndicators() {
            try {
                const data = await fetchAPI('/model_indicators');
                const container = document.getElementById('model-indicators');
                
                if (data.indicators) {
                    let html = '';
                    const indicators = data.indicators;
                    
                    // Show key indicators
                    const keyIndicators = ['close', 'rsi', 'macd', 'volume'];
                    keyIndicators.forEach(indicator => {
                        if (indicators[indicator] !== undefined) {
                            html += `
                                <div class="metric">
                                    <span class="metric-label">${indicator.toUpperCase()}</span>
                                    <span class="metric-value">${indicators[indicator]}</span>
                                </div>
                            `;
                        }
                    });
                    
                    container.innerHTML = html || '<div class="loading">No indicator data available</div>';
                } else {
                    container.innerHTML = '<div class="loading">No indicator data available</div>';
                }
            } catch (error) {
                showError('Failed to load model indicators');
            }
        }

        // Update trade history
        async function updateTradeHistory() {
            try {
                const data = await fetchAPI('/trade_history');
                const container = document.getElementById('trade-history');
                
                if (data && data.length > 0) {
                    let html = `
                        <table class="trades-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Action</th>
                                    <th>Price</th>
                                    <th>Shares</th>
                                    <th>Capital</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    data.slice(0, 10).forEach(trade => {
                        const actionClass = trade.action === 'buy' ? 'action-buy' : 'action-sell';
                        html += `
                            <tr>
                                <td>${formatDate(trade.timestamp)}</td>
                                <td class="${actionClass}">${trade.action.toUpperCase()}</td>
                                <td>${formatCurrency(trade.price)}</td>
                                <td>${trade.shares}</td>
                                <td>${formatCurrency(trade.capital)}</td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div class="loading">No trade history available</div>';
                }
            } catch (error) {
                showError('Failed to load trade history');
            }
        }

        // Refresh all data
        function refreshData() {
            updateWalletBalance();
            updateProfitLoss();
            updateTrainingStatus();
            updateModelIndicators();
            updateTradeHistory();
        }

        // Initialize dashboard
        function initDashboard() {
            // Initial load
            refreshData();
            
            // Set up periodic updates
            setInterval(updateWalletBalance, UPDATE_INTERVALS.wallet);
            setInterval(updateProfitLoss, UPDATE_INTERVALS.profit);
            setInterval(updateTrainingStatus, UPDATE_INTERVALS.status);
            setInterval(updateModelIndicators, UPDATE_INTERVALS.indicators);
            setInterval(updateTradeHistory, UPDATE_INTERVALS.trades);
        }

        // Start the dashboard when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>